{"version":3,"sources":["../../src/classes/LocalesManager.ts"],"sourcesContent":["import { INodeSchema } from \"interfaces\";\r\nimport { ILocales, ILocalesManager } from \"interfaces/loacales\";\r\nimport { isArr, isObj, isStr } from \"utils/types\";\r\nimport _ from \"lodash\"\r\n\r\nexport class LocalesManager implements ILocalesManager {\r\n  locales: ILocales = {\r\n  }\r\n  constructor(private lang: string) { }\r\n\r\n  setLanguage(lang: string): void {\r\n    this.lang = lang\r\n  }\r\n\r\n  getMessage(key: string): string | null {\r\n    return this.getValueByKey(this.locales[this.lang], key)\r\n  }\r\n\r\n  getResouceMessage(key: string): string | null {\r\n    const currenLocales = this.locales[this.lang]?.resources\r\n    return this.getValueByKey(currenLocales || {}, key)\r\n  }\r\n\r\n  getComponentMessage(componentName: string, key: string): string | null {\r\n    const currenLocales = this.locales[this.lang]?.components\r\n    return this.getValueByKey(currenLocales?.[componentName] || {},key)\r\n  }\r\n\r\n  getToolsMessage(key: string): string | null {\r\n    const currenLocales = this.locales[this.lang]?.tools\r\n    return this.getValueByKey(currenLocales || {}, key)\r\n  }\r\n\r\n  registerLocales(...locales: ILocales[]): void {\r\n    this.locales = _.merge(this.locales, ...locales)\r\n  }\r\n  registerResourceLocales(...locales: ILocales[]): void {\r\n    this.registerLocalesOnItem(\"resources\", ...locales)\r\n  }\r\n\r\n  registerComponentsLocales(...locales: ILocales[]): void {\r\n    this.registerLocalesOnItem(\"components\", ...locales)\r\n  }\r\n\r\n  registerComponentLocales(componentName: string, locales: ILocales): void {\r\n    for (const lang of Object.keys(locales)) {\r\n      if (!this.locales[lang]) {\r\n        this.locales[lang] = {}\r\n      }\r\n      const currentlangLocales = this.locales[lang]\r\n      if (!currentlangLocales.components) {\r\n        currentlangLocales.components = {}\r\n      }\r\n      currentlangLocales.components[componentName] = locales[lang]\r\n    }\r\n  }\r\n\r\n  registerToolsLocales(...locales: ILocales[]): void {\r\n    this.registerLocalesOnItem(\"tools\", ...locales)\r\n  }\r\n\r\n  translateDesignerSchema(componentName: string, schema: INodeSchema): INodeSchema {\r\n    return this.translateObject(componentName, schema)\r\n  }\r\n\r\n  private translateObject(componentName: string, obj: any) {\r\n    for (const key of Object.keys(obj)) {\r\n      if (isStr(obj[key])) {\r\n        obj[key] = this.translateString(componentName, obj[key])\r\n      } else if (isObj(obj[key])) {\r\n        obj[key] = this.translateObject(componentName, obj[key])\r\n      } else if (isArr(obj[key])) {\r\n        obj[key] = this.translateArray(componentName, obj[key])\r\n      }\r\n    }\r\n\r\n    return obj\r\n  }\r\n\r\n  private translateArray(componentName: string, arr: any[]) {\r\n    arr.forEach((item, index) => {\r\n      if (isStr(item)) {\r\n        arr[index] = this.translateString(componentName, item)\r\n      } else if (isObj(item)) {\r\n        arr[index] = this.translateObject(componentName, item)\r\n      } else if (isArr(item)) {\r\n        arr[index] = this.translateArray(componentName, item)\r\n      }\r\n    })\r\n\r\n    return arr\r\n  }\r\n\r\n  private translateString(componentName: string, str: string) {\r\n    if (str.startsWith('$')) {\r\n      const token = str.substring(1)\r\n\r\n      return this.getMessage(token) || this.getToolsMessage(token) || this.getComponentMessage(componentName, \"settings.\" + token) || str\r\n    }\r\n\r\n    return str\r\n  }\r\n\r\n  private registerLocalesOnItem(item: \"components\" | \"resources\" | \"tools\", ...locales: ILocales[]): void {\r\n    for (const locale of locales) {\r\n      for (const lang of Object.keys(locale)) {\r\n        if (!this.locales[lang]) {\r\n          this.locales[lang] = {}\r\n        }\r\n        this.locales[lang][item] = _.merge(this.locales[lang]?.[item] || {}, locale[lang])\r\n      }\r\n    }\r\n  }\r\n\r\n  private getValueByKey(locales: any, key: string): string | null {\r\n    const [subKey, ...others] = key.split(\".\")\r\n\r\n    if (!others?.length) {\r\n      return locales[subKey]\r\n    } else {\r\n      const valueByMergedKey = locales[key]\r\n      //处理这种情况：Layout.Header\r\n      if(valueByMergedKey){\r\n        return valueByMergedKey\r\n      }\r\n      return this.getValueByKey(locales[subKey] || {}, others.join(\".\"))\r\n    }\r\n  }\r\n}"],"names":["isArr","isObj","isStr","_","LocalesManager","setLanguage","lang","getMessage","key","getValueByKey","locales","getResouceMessage","currenLocales","resources","getComponentMessage","componentName","components","getToolsMessage","tools","registerLocales","merge","registerResourceLocales","registerLocalesOnItem","registerComponentsLocales","registerComponentLocales","Object","keys","currentlangLocales","registerToolsLocales","translateDesignerSchema","schema","translateObject","obj","translateString","translateArray","arr","forEach","item","index","str","startsWith","token","substring","locale","subKey","others","split","length","valueByMergedKey","join","constructor"],"mappings":"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"}