{"version":3,"sources":["../../src/classes/Monitor.ts"],"sourcesContent":["import { invariant } from '../utils/util-invariant'\r\nimport type { Store } from 'redux'\r\nimport {\r\n\tActiveDocumentListener,\r\n\tActiveNodeListener,\r\n\tCanvasWidthLimitsListener,\r\n\tCanvasWidthListener,\r\n\tCurrentNodesChangeListener,\r\n\tDefulstViewType,\r\n\tDocumentViewListener,\r\n\tDraggingNodesListener,\r\n\tDraggingResourceListener,\r\n\tDragOverListener,\r\n\tHistoryListener,\r\n\tID,\r\n\tIMonitor,\r\n\tITreeNode,\r\n\tLangListener,\r\n\tListener,\r\n\tNodeListener,\r\n\tSelectedChangeListener,\r\n\tDocumentSelectionMode,\r\n\tSelectionModeListener,\r\n\tSnapshotIndexListener,\r\n\tThemeModeListener,\r\n\tUnsubscribe,\r\n} from '../interfaces/index'\r\nimport type { State } from '../reducers/index'\r\nimport { DragOverState } from 'reducers/dragOver'\r\n\r\n/**\r\n * 为优化性能而生\r\n */\r\nexport class NodeChangeHandler {\r\n\tlisteners: {\r\n\t\t[id: ID]: NodeListener[] | undefined\r\n\t} = {}\r\n\r\n\thandleNodeChange = (node: ITreeNode) => {\r\n\t\tfor (const id of Object.keys(this.listeners)) {\r\n\t\t\tif (id === node.id) {\r\n\t\t\t\tconst listeners = this.listeners[id]\r\n\t\t\t\tfor (const listener of listeners || []) {\r\n\t\t\t\t\tlistener(node)\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tsubscribeToNodeChanged = (id: ID, listener: NodeListener): Unsubscribe => {\r\n\t\tconst unsubscribe = () => {\r\n\t\t\tthis.removeListener(id, listener)\r\n\t\t}\r\n\t\tif (!this.listeners[id]) {\r\n\t\t\tthis.listeners[id] = []\r\n\t\t}\r\n\t\tthis.listeners[id]?.push(listener)\r\n\t\treturn unsubscribe;\r\n\t}\r\n\r\n\tremoveListener(id: ID, listener: NodeListener) {\r\n\t\tthis.listeners[id] = this.listeners[id]?.filter(lis => lis !== listener)\r\n\t}\r\n}\r\n\r\nexport class Monitor implements IMonitor {\r\n\tprivate store: Store<State>\r\n\tprivate nodechnageHandler = new NodeChangeHandler()\r\n\r\n\tpublic constructor(store: Store<State>) {\r\n\t\tthis.store = store\r\n\t\tthis.doSubscribeToNodeChanged(this.nodechnageHandler.handleNodeChange)\r\n\t}\r\n\r\n\tgetSelectionMode(document: string): DocumentSelectionMode {\r\n\t\treturn this.store.getState().documentsById[document]?.selectionMode || DocumentSelectionMode.Normal\r\n\t}\r\n\r\n\tgetCurrentNode(): ITreeNode | null {\r\n\t\tconst state = this.getState()\r\n\t\tif (!state.activedDocumentId) {\r\n\t\t\treturn null\r\n\t\t}\r\n\r\n\t\tconst currentId = this.getSeletedNodeId(state.documentsById[state.activedDocumentId]?.selectedIds || [])\r\n\t\treturn this.getNode(currentId)\r\n\t}\r\n\r\n\tgetCurrentTree(): ITreeNode | null {\r\n\t\tconst state = this.getState()\r\n\t\tif (!state.activedDocumentId) {\r\n\t\t\treturn null\r\n\t\t}\r\n\t\tconst documentState = state.documentsById[state.activedDocumentId]\r\n\t\tif (documentState?.rootId) {\r\n\t\t\treturn this.getNode(documentState.rootId)\r\n\t\t}\r\n\t\treturn null\r\n\t}\r\n\r\n\tgetNodeDocumentId(nodeId: string): string | undefined {\r\n\t\treturn this.getNode(nodeId)?.documentId\r\n\t}\r\n\r\n\tgetNode(nodeId: string): ITreeNode | null {\r\n\t\tconst nodes = this.store.getState().nodesById\r\n\t\tfor (const ndId of Object.keys(nodes)) {\r\n\t\t\tif (ndId === nodeId) {\r\n\t\t\t\treturn nodes[ndId]\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null\r\n\t}\r\n\r\n\tgetDocumentRootNode(doumentId: ID): ITreeNode | null {\r\n\t\tconst doc = this.getState().documentsById[doumentId]\r\n\t\treturn doc?.rootId ? this.getNode(doc?.rootId) : null\r\n\t}\r\n\r\n\tgetState(): State {\r\n\t\treturn this.store.getState()\r\n\t}\r\n\r\n\tsubscribeToDraggingNodes(listener: DraggingNodesListener): Unsubscribe {\r\n\t\tinvariant(typeof listener === 'function', 'listener must be a function.')\r\n\r\n\t\tlet previousState = this.store.getState().draggingNodes\r\n\t\tconst handleChange = () => {\r\n\t\t\tconst nextState = this.store.getState().draggingNodes\r\n\t\t\tif (nextState === previousState) {\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\r\n\t\t\tpreviousState = nextState\r\n\t\t\tlistener(nextState || null)\r\n\t\t}\r\n\r\n\t\treturn this.store.subscribe(handleChange)\r\n\t}\r\n\r\n\tsubscribeToDraggingResource(listener: DraggingResourceListener): Unsubscribe {\r\n\t\tinvariant(typeof listener === 'function', 'listener must be a function.')\r\n\r\n\t\tlet previousState = this.store.getState().draggingResource\r\n\t\tconst handleChange = () => {\r\n\t\t\tconst nextState = this.store.getState().draggingResource\r\n\t\t\tif (nextState === previousState) {\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\r\n\t\t\tpreviousState = nextState\r\n\t\t\tlistener(nextState || null)\r\n\t\t}\r\n\r\n\t\treturn this.store.subscribe(handleChange)\r\n\t}\r\n\r\n\tsubscribeToDragOver(listener: DragOverListener): Unsubscribe {\r\n\t\tinvariant(typeof listener === 'function', 'listener must be a function.')\r\n\r\n\t\tlet previousState = this.store.getState().dragOver\r\n\t\tconst handleChange = () => {\r\n\t\t\tconst nextState = this.store.getState().dragOver\r\n\t\t\tif (nextState === previousState) {\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\r\n\t\t\tpreviousState = nextState\r\n\t\t\tlistener(nextState || null)\r\n\t\t}\r\n\r\n\t\treturn this.store.subscribe(handleChange)\r\n\t}\r\n\r\n\tgetCurrentSelectedIds(): string[] | null {\r\n\t\treturn this.getDocumentSelectedIds(this.getState().activedDocumentId || \"\")\r\n\t}\r\n\r\n\tgetDocumentSelectedIds(documentId: ID): ID[] | null {\r\n\t\treturn this.store.getState().documentsById[documentId]?.selectedIds || null\r\n\t}\r\n\tgetDrageOver(): DragOverState {\r\n\t\treturn this.store.getState().dragOver || null\r\n\t}\r\n\r\n\tpublic subscribeToStateChange(listener: Listener): Unsubscribe {\r\n\t\tinvariant(typeof listener === 'function', 'listener must be a function.')\r\n\r\n\t\tlet prevStateId = this.store.getState().stateId\r\n\t\tconst handleChange = () => {\r\n\t\t\tconst state = this.store.getState()\r\n\t\t\tconst currentStateId = state.stateId\r\n\t\t\ttry {\r\n\t\t\t\tconst canSkipListener =\r\n\t\t\t\t\tcurrentStateId === prevStateId //||\r\n\t\t\t\t// (currentStateId === prevStateId + 1 &&\r\n\t\t\t\t// \t!areDirty(state.dirtyHandlerIds, handlerIds))\r\n\r\n\t\t\t\tif (!canSkipListener) {\r\n\t\t\t\t\tlistener()\r\n\t\t\t\t}\r\n\t\t\t} finally {\r\n\t\t\t\tprevStateId = currentStateId\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn this.store.subscribe(handleChange)\r\n\t}\r\n\r\n\tsubscribeToSelectChange(listener: SelectedChangeListener): Unsubscribe {\r\n\t\tinvariant(typeof listener === 'function', 'listener must be a function.')\r\n\t\tlet previousState = this.store.getState().documentsById\r\n\t\tconst handleChange = () => {\r\n\t\t\tconst nextState = this.store.getState().documentsById\r\n\t\t\tfor (const key of Object.keys(nextState)) {\r\n\t\t\t\tif (nextState[key]?.selectedIds === previousState[key]?.selectedIds) {\r\n\t\t\t\t\tcontinue\r\n\t\t\t\t}\r\n\t\t\t\tlistener(nextState[key]?.selectedIds || null, key)\r\n\t\t\t}\r\n\t\t\tpreviousState = nextState\r\n\t\t}\r\n\t\treturn this.store.subscribe(handleChange)\r\n\t}\r\n\r\n\tsubscribeToCurrentNodeChanged(listener: CurrentNodesChangeListener): Unsubscribe {\r\n\t\tinvariant(typeof listener === 'function', 'listener must be a function.')\r\n\t\tconst activedDocumentId = this.getState().activedDocumentId\r\n\t\tconst documentState = this.getState().documentsById[activedDocumentId || \"\"]\r\n\t\tlet previousNodeId = this.getSeletedNodeId(documentState?.selectedIds || [])\r\n\t\tconst handleChange = () => {\r\n\t\t\tconst activedDocumentId = this.getState().activedDocumentId\r\n\t\t\tconst nextState = this.store.getState().documentsById[activedDocumentId || \"\"]\r\n\t\t\tconst nodeId = this.getSeletedNodeId(nextState?.selectedIds || [])\r\n\t\t\tconst node = this.getState().nodesById[nodeId] || null\r\n\t\t\tif (previousNodeId !== node?.id) {\r\n\t\t\t\tlistener(node)\r\n\t\t\t}\r\n\t\t\tpreviousNodeId = node?.id\r\n\t\t}\r\n\t\treturn this.store.subscribe(handleChange)\r\n\t}\r\n\tsubscribeToHasNodeChanged(listener: Listener): Unsubscribe {\r\n\t\tinvariant(typeof listener === 'function', 'listener must be a function.')\r\n\t\tlet previousState = this.store.getState().nodesById\r\n\t\tconst handleChange = () => {\r\n\t\t\tconst nextState = this.store.getState().nodesById\r\n\t\t\tif (nextState !== previousState) {\r\n\t\t\t\tlistener()\r\n\t\t\t}\r\n\t\t\tpreviousState = nextState\r\n\t\t}\r\n\t\treturn this.store.subscribe(handleChange)\r\n\t}\r\n\r\n\t//隔离NodesById的变化\r\n\tsubscribeToNodeChanged(id: ID, listener: NodeListener): Unsubscribe {\r\n\t\tinvariant(typeof listener === 'function', 'listener must be a function.')\r\n\t\treturn this.nodechnageHandler.subscribeToNodeChanged(id, listener)\r\n\t}\r\n\r\n\tsubscribeToLangeChange(listener: LangListener): Unsubscribe {\r\n\t\tinvariant(typeof listener === 'function', 'listener must be a function.')\r\n\r\n\t\tlet previousState = this.store.getState().lang\r\n\t\tconst handleChange = () => {\r\n\t\t\tconst nextState = this.store.getState().lang\r\n\t\t\tif (nextState === previousState) {\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\r\n\t\t\tpreviousState = nextState\r\n\t\t\tlistener(nextState)\r\n\t\t}\r\n\r\n\t\treturn this.store.subscribe(handleChange)\r\n\t}\r\n\r\n\tsubscribeToThemeModeChange(listener: ThemeModeListener): Unsubscribe {\r\n\t\tinvariant(typeof listener === 'function', 'listener must be a function.')\r\n\r\n\t\tlet previousState = this.store.getState().themeMode\r\n\t\tconst handleChange = () => {\r\n\t\t\tconst nextState = this.store.getState().themeMode\r\n\t\t\tif (nextState === previousState) {\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\r\n\t\t\tpreviousState = nextState\r\n\t\t\tlistener(nextState)\r\n\t\t}\r\n\r\n\t\treturn this.store.subscribe(handleChange)\r\n\t}\r\n\r\n\tsubscribeToActiveDocumentChanged(listener: ActiveDocumentListener): Unsubscribe {\r\n\t\tinvariant(typeof listener === 'function', 'listener must be a function.')\r\n\r\n\t\tlet previousState = this.store.getState().activedDocumentId\r\n\t\tconst handleChange = () => {\r\n\t\t\tconst nextState = this.store.getState().activedDocumentId\r\n\t\t\tif (nextState === previousState) {\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\r\n\t\t\tpreviousState = nextState\r\n\t\t\tlistener(nextState)\r\n\t\t}\r\n\r\n\t\treturn this.store.subscribe(handleChange)\r\n\t}\r\n\r\n\tsubscribeToActiveChanged(listener: ActiveNodeListener): Unsubscribe {\r\n\t\tinvariant(typeof listener === 'function', 'listener must be a function.')\r\n\r\n\t\tlet previousState = this.store.getState().activedNodeId\r\n\t\tconst handleChange = () => {\r\n\t\t\tconst nextState = this.store.getState().activedNodeId\r\n\t\t\tif (nextState === previousState) {\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\r\n\t\t\tpreviousState = nextState\r\n\t\t\tlistener(nextState)\r\n\t\t}\r\n\r\n\t\treturn this.store.subscribe(handleChange)\r\n\t}\r\n\tsubscribeToHistoryChange(documentId: string, listener: HistoryListener): Unsubscribe {\r\n\t\tinvariant(typeof listener === 'function', 'listener must be a function.')\r\n\r\n\t\tlet previousState = this.store.getState().documentsById[documentId]?.history\r\n\t\tconst handleChange = () => {\r\n\t\t\tconst nextState = this.store.getState().documentsById[documentId]?.history\r\n\t\t\tif (nextState === previousState) {\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\r\n\t\t\tpreviousState = nextState\r\n\t\t\tlistener(nextState || [])\r\n\t\t}\r\n\r\n\t\treturn this.store.subscribe(handleChange)\r\n\t}\r\n\tsubscribeToSnapshotIndexChange(documentId: string, listener: SnapshotIndexListener): Unsubscribe {\r\n\t\tinvariant(typeof listener === 'function', 'listener must be a function.')\r\n\r\n\t\tlet previousState = this.store.getState().documentsById[documentId]?.snapshotIndex\r\n\t\tconst handleChange = () => {\r\n\t\t\tconst nextState = this.store.getState().documentsById[documentId]?.snapshotIndex\r\n\t\t\tif (nextState === previousState) {\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\r\n\t\t\tpreviousState = nextState\r\n\t\t\tlistener(nextState || 0)\r\n\t\t}\r\n\r\n\t\treturn this.store.subscribe(handleChange)\r\n\t}\r\n\r\n\tsubscribeToCanvasWidthChange(documentId: string, listener: CanvasWidthListener): Unsubscribe {\r\n\t\tinvariant(typeof listener === 'function', 'listener must be a function.')\r\n\r\n\t\tlet previousState = this.store.getState().documentsById[documentId]?.canvasWidth\r\n\t\tconst handleChange = () => {\r\n\t\t\tconst nextState = this.store.getState().documentsById[documentId]?.canvasWidth\r\n\t\t\tif (nextState === previousState) {\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\r\n\t\t\tpreviousState = nextState\r\n\t\t\tlistener(nextState || 0)\r\n\t\t}\r\n\r\n\t\treturn this.store.subscribe(handleChange)\r\n\t}\r\n\r\n\tsubscribeToCanvasWidthLimitsChange(documentId: string, listener: CanvasWidthLimitsListener): Unsubscribe {\r\n\t\tinvariant(typeof listener === 'function', 'listener must be a function.')\r\n\r\n\t\tlet previousState = this.store.getState().documentsById[documentId]?.canvasWidthLimits\r\n\t\tconst handleChange = () => {\r\n\t\t\tconst nextState = this.store.getState().documentsById[documentId]?.canvasWidthLimits\r\n\t\t\tif (nextState === previousState) {\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\r\n\t\t\tpreviousState = nextState\r\n\t\t\tlistener(nextState || null)\r\n\t\t}\r\n\t\treturn this.store.subscribe(handleChange)\r\n\t}\r\n\tsubscribeToDocumentViewChange(documentId: string, listener: DocumentViewListener): Unsubscribe {\r\n\t\tinvariant(typeof listener === 'function', 'listener must be a function.')\r\n\r\n\t\tlet previousState = this.store.getState().documentsById[documentId]?.viewType\r\n\t\tconst handleChange = () => {\r\n\t\t\tconst nextState = this.store.getState().documentsById[documentId]?.viewType\r\n\t\t\tif (nextState === previousState) {\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\r\n\t\t\tpreviousState = nextState\r\n\t\t\tlistener(nextState || DefulstViewType)\r\n\t\t}\r\n\t\treturn this.store.subscribe(handleChange)\r\n\t}\r\n\r\n\tsubscribeToSelectionMode(documentId: string, listener: SelectionModeListener): Unsubscribe {\r\n\t\tinvariant(typeof listener === 'function', 'listener must be a function.')\r\n\r\n\t\tlet previousState = this.store.getState().documentsById[documentId]?.selectionMode\r\n\t\tconst handleChange = () => {\r\n\t\t\tconst nextState = this.store.getState().documentsById[documentId]?.selectionMode\r\n\t\t\tif (nextState === previousState) {\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\r\n\t\t\tpreviousState = nextState\r\n\t\t\tlistener(nextState || DocumentSelectionMode.Normal)\r\n\t\t}\r\n\t\treturn this.store.subscribe(handleChange)\r\n\t}\r\n\r\n\tisDragging(): boolean {\r\n\t\tconst state = this.store.getState()\r\n\r\n\t\treturn !!state.draggingResource || !!state.draggingNodes\r\n\t}\r\n\r\n\tprivate getSeletedNodeId(selectedIds?: ID[]) {\r\n\t\treturn selectedIds?.length === 1 ? (selectedIds?.[0] || \"\") : \"\"\r\n\t}\r\n\r\n\tprivate doSubscribeToNodeChanged(listener: NodeListener): Unsubscribe {\r\n\t\tinvariant(typeof listener === 'function', 'listener must be a function.')\r\n\t\tlet previousState = this.store.getState().nodesById\r\n\t\tconst handleChange = () => {\r\n\t\t\tconst nextState = this.store.getState().nodesById\r\n\t\t\tif (nextState !== previousState) {\r\n\t\t\t\tfor (const nodeId of Object.keys(nextState)) {\r\n\t\t\t\t\tif (nextState[nodeId] !== previousState?.[nodeId]) {\r\n\t\t\t\t\t\tlistener(nextState[nodeId])\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tpreviousState = nextState\r\n\t\t}\r\n\t\treturn this.store.subscribe(handleChange)\r\n\t}\r\n}\r\n"],"names":["invariant","DefulstViewType","DocumentSelectionMode","NodeChangeHandler","removeListener","id","listener","listeners","filter","lis","handleNodeChange","node","Object","keys","subscribeToNodeChanged","unsubscribe","push","Monitor","getSelectionMode","document","store","getState","documentsById","selectionMode","Normal","getCurrentNode","state","activedDocumentId","currentId","getSeletedNodeId","selectedIds","getNode","getCurrentTree","documentState","rootId","getNodeDocumentId","nodeId","documentId","nodes","nodesById","ndId","getDocumentRootNode","doumentId","doc","subscribeToDraggingNodes","previousState","draggingNodes","handleChange","nextState","subscribe","subscribeToDraggingResource","draggingResource","subscribeToDragOver","dragOver","getCurrentSelectedIds","getDocumentSelectedIds","getDrageOver","subscribeToStateChange","prevStateId","stateId","currentStateId","canSkipListener","subscribeToSelectChange","key","subscribeToCurrentNodeChanged","previousNodeId","subscribeToHasNodeChanged","nodechnageHandler","subscribeToLangeChange","lang","subscribeToThemeModeChange","themeMode","subscribeToActiveDocumentChanged","subscribeToActiveChanged","activedNodeId","subscribeToHistoryChange","history","subscribeToSnapshotIndexChange","snapshotIndex","subscribeToCanvasWidthChange","canvasWidth","subscribeToCanvasWidthLimitsChange","canvasWidthLimits","subscribeToDocumentViewChange","viewType","subscribeToSelectionMode","isDragging","length","doSubscribeToNodeChanged"],"mappings":"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"}