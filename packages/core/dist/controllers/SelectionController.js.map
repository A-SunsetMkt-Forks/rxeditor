{"version":3,"sources":["../../src/controllers/SelectionController.ts"],"sourcesContent":["import { IDesignerEngine, NodeType, Unsubscribe } from \"core\";\r\nimport { MouseClickEvent } from \"shell/events\";\r\nimport { IPlugin } from \"interfaces/plugin\";\r\n\r\nexport class SelectionControllerImpl implements IPlugin {\r\n  name: string = \"default.selection-controller\";\r\n\r\n  unsucribe: Unsubscribe\r\n  \r\n  constructor(protected engine: IDesignerEngine) {\r\n    this.unsucribe = this.engine.getShell().subscribeTo(MouseClickEvent, this.handleNodeClick)\r\n  }\r\n\r\n  handleNodeClick = (e: MouseClickEvent): void => {\r\n    const monitor = this.engine.getMonitor()\r\n    const { rxId, nodeType } = e.data.targetRx || {}\r\n    if (rxId && nodeType === NodeType.Node) {\r\n      const documentId = monitor.getNodeDocumentId(rxId)\r\n      if(!documentId){\r\n        return\r\n      }\r\n      const selectedNodes = monitor.getDocumentSelectedIds(documentId)\r\n      if (selectedNodes && selectedNodes.length === 1 && selectedNodes[0] === rxId) {\r\n        return\r\n      }\r\n      this.engine.getActions().selectNodes([rxId], documentId)\r\n    }\r\n  }\r\n\r\n  destory(): void {\r\n    this.unsucribe()\r\n  }\r\n\r\n}\r\n\r\nexport const SelectionController = (engine:IDesignerEngine)=>{\r\n  return new SelectionControllerImpl(engine)\r\n}"],"names":["NodeType","MouseClickEvent","SelectionControllerImpl","destory","unsucribe","constructor","engine","name","handleNodeClick","e","monitor","getMonitor","rxId","nodeType","data","targetRx","Node","documentId","getNodeDocumentId","selectedNodes","getDocumentSelectedIds","length","getActions","selectNodes","getShell","subscribeTo","SelectionController"],"mappings":"AAAA,SAA0BA,QAAQ,QAAqB,OAAO;AAC9D,SAASC,eAAe,QAAQ,eAAe;AAG/C,OAAO,MAAMC;IAyBXC,UAAgB;QACd,IAAI,CAACC,SAAS;IAChB;IAtBAC,YAAsBC,OAAyB;sBAAzBA;aAJtBC,OAAe;aAQfC,kBAAkB,CAACC,IAA6B;YAC9C,MAAMC,UAAU,IAAI,CAACJ,MAAM,CAACK,UAAU;YACtC,MAAM,EAAEC,KAAI,EAAEC,SAAQ,EAAE,GAAGJ,EAAEK,IAAI,CAACC,QAAQ,IAAI,CAAC;YAC/C,IAAIH,QAAQC,aAAab,SAASgB,IAAI,EAAE;gBACtC,MAAMC,aAAaP,QAAQQ,iBAAiB,CAACN;gBAC7C,IAAG,CAACK,YAAW;oBACb;gBACF,CAAC;gBACD,MAAME,gBAAgBT,QAAQU,sBAAsB,CAACH;gBACrD,IAAIE,iBAAiBA,cAAcE,MAAM,KAAK,KAAKF,aAAa,CAAC,EAAE,KAAKP,MAAM;oBAC5E;gBACF,CAAC;gBACD,IAAI,CAACN,MAAM,CAACgB,UAAU,GAAGC,WAAW,CAAC;oBAACX;iBAAK,EAAEK;YAC/C,CAAC;QACH;QAjBE,IAAI,CAACb,SAAS,GAAG,IAAI,CAACE,MAAM,CAACkB,QAAQ,GAAGC,WAAW,CAACxB,iBAAiB,IAAI,CAACO,eAAe;IAC3F;AAsBF,CAAC;AAED,OAAO,MAAMkB,sBAAsB,CAACpB,SAAyB;IAC3D,OAAO,IAAIJ,wBAAwBI;AACrC,EAAC"}