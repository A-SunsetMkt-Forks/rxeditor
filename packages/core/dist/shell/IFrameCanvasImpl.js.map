{"version":3,"sources":["../../src/shell/IFrameCanvasImpl.ts"],"sourcesContent":["import { IShellPane, ID, IDesignerEngine, IDriver, IDriverFactory, RXID_ATTR_NAME, IRect } from \"../interfaces\";\r\n\r\nexport class IFrameCanvasImpl implements IShellPane {\r\n  private dirvers: IDriver[] = []\r\n\r\n  constructor(\r\n    engine: IDesignerEngine,\r\n    private iframe: HTMLIFrameElement,\r\n    public id: ID,\r\n    private driverFactories: IDriverFactory[]\r\n  ) {\r\n    for (const dirverFactory of this.driverFactories) {\r\n      if (this.iframe.contentWindow?.document) {\r\n        this.dirvers.push(dirverFactory(engine.getShell(), this.iframe.contentWindow?.document))\r\n      }\r\n    }\r\n  }\r\n  getContainerRect(): IRect | null {\r\n    const rect = this.iframe.contentWindow?.document?.body?.getBoundingClientRect()\r\n    if (!rect) {\r\n      return null\r\n    }\r\n    return { width: rect.width, height: rect.height, x: 0, y: 0, }\r\n  }\r\n\r\n  appendChild(child: HTMLElement): void {\r\n    this.body?.append(child)\r\n  }\r\n  contains(child: HTMLElement): boolean {\r\n    return this.body?.contains(child) || false\r\n  }\r\n  removeChild(child: HTMLElement): void {\r\n    this.body?.removeChild(child)\r\n  }\r\n  getElement(id: string): HTMLElement | null {\r\n    return this.body?.querySelector(`[${RXID_ATTR_NAME}=\"${id}\"]`) || null\r\n  }\r\n  getTopRect(nodeId: string): IRect | null {\r\n    const rect = this.getElement(nodeId)?.getBoundingClientRect();\r\n    if (rect) {\r\n      const frameRect = this.iframe.getBoundingClientRect()\r\n      const scale = frameRect.width / (this.iframe as any)['offsetWidth']\r\n      rect.x = rect.x * scale + frameRect.x\r\n      rect.y = rect.y * scale + frameRect.y\r\n\r\n      return rect\r\n    }\r\n    return null\r\n  }\r\n  destory(): void {\r\n    for (const driver of this.dirvers) {\r\n      driver.teardown()\r\n    }\r\n    this.dirvers = []\r\n  }\r\n\r\n  private get body() {\r\n    return this.iframe.contentWindow?.document.body\r\n  }\r\n}"],"names":["RXID_ATTR_NAME","IFrameCanvasImpl","getContainerRect","rect","iframe","contentWindow","document","body","getBoundingClientRect","width","height","x","y","appendChild","child","append","contains","removeChild","getElement","id","querySelector","getTopRect","nodeId","frameRect","scale","destory","driver","dirvers","teardown","constructor","engine","driverFactories","dirverFactory","push","getShell"],"mappings":"AAAA,SAAmEA,cAAc,QAAe,gBAAgB;AAEhH,OAAO,MAAMC;IAeXC,mBAAiC;YAClB;QAAb,MAAMC,OAAO,CAAA,6BAAA,IAAI,CAACC,MAAM,CAACC,aAAa,cAAzB,wCAAA,KAAA,IAAA,uCAAA,2BAA2BC,uEAA3B,KAAA,IAAA,gFAAqCC,wEAArC,KAAA,IAAA,yCAA2CC;QACxD,IAAI,CAACL,MAAM;YACT,OAAO,IAAI;QACb,CAAC;QACD,OAAO;YAAEM,OAAON,KAAKM,KAAK;YAAEC,QAAQP,KAAKO,MAAM;YAAEC,GAAG;YAAGC,GAAG;QAAG;IAC/D;IAEAC,YAAYC,KAAkB,EAAQ;YACpC;QAAA,CAAA,aAAA,IAAI,CAACP,IAAI,cAAT,wBAAA,KAAA,IAAA,WAAWQ,OAAOD;IACpB;IACAE,SAASF,KAAkB,EAAW;YAC7B;QAAP,OAAO,CAAA,CAAA,aAAA,IAAI,CAACP,IAAI,cAAT,wBAAA,KAAA,IAAA,WAAWS,SAASF,WAAU,KAAK;IAC5C;IACAG,YAAYH,KAAkB,EAAQ;YACpC;QAAA,CAAA,aAAA,IAAI,CAACP,IAAI,cAAT,wBAAA,KAAA,IAAA,WAAWU,YAAYH;IACzB;IACAI,WAAWC,EAAU,EAAsB;YAClC;QAAP,OAAO,CAAA,CAAA,aAAA,IAAI,CAACZ,IAAI,cAAT,wBAAA,KAAA,IAAA,WAAWa,cAAc,CAAC,CAAC,EAAEpB,eAAe,EAAE,EAAEmB,GAAG,EAAE,CAAC,MAAK,IAAI;IACxE;IACAE,WAAWC,MAAc,EAAgB;YAC1B;QAAb,MAAMnB,OAAO,CAAA,mBAAA,IAAI,CAACe,UAAU,CAACI,qBAAhB,8BAAA,KAAA,IAAA,iBAAyBd;QACtC,IAAIL,MAAM;YACR,MAAMoB,YAAY,IAAI,CAACnB,MAAM,CAACI,qBAAqB;YACnD,MAAMgB,QAAQD,UAAUd,KAAK,GAAG,AAAC,IAAI,CAACL,MAAM,AAAQ,CAAC,cAAc;YACnED,KAAKQ,CAAC,GAAGR,KAAKQ,CAAC,GAAGa,QAAQD,UAAUZ,CAAC;YACrCR,KAAKS,CAAC,GAAGT,KAAKS,CAAC,GAAGY,QAAQD,UAAUX,CAAC;YAErC,OAAOT;QACT,CAAC;QACD,OAAO,IAAI;IACb;IACAsB,UAAgB;QACd,KAAK,MAAMC,UAAU,IAAI,CAACC,OAAO,CAAE;YACjCD,OAAOE,QAAQ;QACjB;QACA,IAAI,CAACD,OAAO,GAAG,EAAE;IACnB;IAEA,IAAYpB,OAAO;YACV;QAAP,OAAO,CAAA,6BAAA,IAAI,CAACH,MAAM,CAACC,aAAa,cAAzB,wCAAA,KAAA,IAAA,2BAA2BC,SAASC,IAAI;IACjD;IArDAsB,YACEC,MAAuB,EACf1B,QACDe,IACCY,gBACR;sBAHQ3B;kBACDe;+BACCY;aANFJ,UAAqB,EAAE;QAQ7B,KAAK,MAAMK,iBAAiB,IAAI,CAACD,eAAe,CAAE;gBAC5C;YAAJ,IAAI,CAAA,6BAAA,IAAI,CAAC3B,MAAM,CAACC,aAAa,cAAzB,wCAAA,KAAA,IAAA,2BAA2BC,QAAQ,EAAE;oBACY;gBAAnD,IAAI,CAACqB,OAAO,CAACM,IAAI,CAACD,cAAcF,OAAOI,QAAQ,IAAI,CAAA,8BAAA,IAAI,CAAC9B,MAAM,CAACC,aAAa,cAAzB,yCAAA,KAAA,IAAA,4BAA2BC,QAAQ;YACxF,CAAC;QACH;IACF;AA2CF,CAAC"}