{"version":3,"sources":["../../../src/shell/drivers/CanvasResizeDriver.ts"],"sourcesContent":["import { IDriver, IDriverFactory } from \"interfaces\"\r\nimport { IDispatchable, ICustomEvent } from \"interfaces/event\"\r\nimport { isHTMLElement } from \"utils/html-node\"\r\nimport { CanvasResizeEvent } from \"../events\"\r\n\r\nexport class CanvasResizeDriverImpl implements IDriver {\r\n  resizeObserver: ResizeObserver\r\n\r\n  constructor(private dispatcher: IDispatchable<ICustomEvent<any>>, private element: Element | Node | HTMLElement) {\r\n    this.resizeObserver = new ResizeObserver(this.onResize)\r\n    this.attach()\r\n  }\r\n\r\n  onResize = () => {\r\n    this.dispatcher.dispatch(\r\n      new CanvasResizeEvent()\r\n    )\r\n  }\r\n\r\n  attach() {\r\n    if (isHTMLElement(this.element)) {\r\n      this.resizeObserver.observe(this.element as Element)\r\n    }\r\n    this.win().addEventListener('resize', this.onResize)\r\n  }\r\n\r\n  teardown(): void {\r\n    if (isHTMLElement(this.element)) {\r\n      this.resizeObserver.unobserve(this.element as Element)\r\n    }\r\n    this.resizeObserver.disconnect()\r\n    this.win().removeEventListener('resize', this.onResize)\r\n  }\r\n\r\n  private win(){\r\n    return (this.element as Document)?.defaultView || this.element?.ownerDocument?.defaultView || window\r\n  }\r\n}\r\n\r\nexport const CanvasResizeDriver: IDriverFactory = (\r\n  dispatcher: IDispatchable<ICustomEvent<any>>,\r\n  element: Element | Node | HTMLElement,\r\n) => {\r\n  return new CanvasResizeDriverImpl(\r\n    dispatcher,\r\n    element,\r\n  )\r\n}"],"names":["isHTMLElement","CanvasResizeEvent","CanvasResizeDriverImpl","attach","element","resizeObserver","observe","win","addEventListener","onResize","teardown","unobserve","disconnect","removeEventListener","defaultView","ownerDocument","window","constructor","dispatcher","dispatch","ResizeObserver","CanvasResizeDriver"],"mappings":"AAEA,SAASA,aAAa,QAAQ,kBAAiB;AAC/C,SAASC,iBAAiB,QAAQ,YAAW;AAE7C,OAAO,MAAMC;IAcXC,SAAS;QACP,IAAIH,cAAc,IAAI,CAACI,OAAO,GAAG;YAC/B,IAAI,CAACC,cAAc,CAACC,OAAO,CAAC,IAAI,CAACF,OAAO;QAC1C,CAAC;QACD,IAAI,CAACG,GAAG,GAAGC,gBAAgB,CAAC,UAAU,IAAI,CAACC,QAAQ;IACrD;IAEAC,WAAiB;QACf,IAAIV,cAAc,IAAI,CAACI,OAAO,GAAG;YAC/B,IAAI,CAACC,cAAc,CAACM,SAAS,CAAC,IAAI,CAACP,OAAO;QAC5C,CAAC;QACD,IAAI,CAACC,cAAc,CAACO,UAAU;QAC9B,IAAI,CAACL,GAAG,GAAGM,mBAAmB,CAAC,UAAU,IAAI,CAACJ,QAAQ;IACxD;IAEQF,MAAK;YACH,eAA0C;QAAlD,OAAO,CAAA,CAAC,gBAAA,IAAI,CAACH,OAAO,cAAZ,2BAAD,KAAA,IAAC,cAA2BU,WAAW,AAAD,KAAK,CAAA,CAAA,iBAAA,IAAI,CAACV,OAAO,cAAZ,4BAAA,KAAA,IAAA,+BAAA,eAAcW,oEAAd,KAAA,gCAA6BD,WAAF,AAAD,KAAkBE;IAChG;IA5BAC,YAAoBC,YAAsDd,QAAuC;0BAA7Fc;uBAAsDd;aAK1EK,WAAW,IAAM;YACf,IAAI,CAACS,UAAU,CAACC,QAAQ,CACtB,IAAIlB;QAER;QARE,IAAI,CAACI,cAAc,GAAG,IAAIe,eAAe,IAAI,CAACX,QAAQ;QACtD,IAAI,CAACN,MAAM;IACb;AA0BF,CAAC;AAED,OAAO,MAAMkB,qBAAqC,CAChDH,YACAd,UACG;IACH,OAAO,IAAIF,uBACTgB,YACAd;AAEJ,EAAC"}