{"version":3,"sources":["../../../../src/shell/events/mouse/AbstractMouseEvent.ts"],"sourcesContent":["import { getRecentRxElement } from \"shell/utils/getRecentRxElement\"\r\nimport { ID, NodeStatus, NodeType, RXID_ATTR_NAME, RX_NODE_TYPE_ATTR_NAME, RX_STATUS_ATTR_NAME } from \"interfaces\"\r\nimport { IEventData } from \"../eventdata\"\r\n\r\nexport interface NodeRxInfo {\r\n  rxId?: ID,\r\n  nodeType?: NodeType,\r\n  nodeStatus?: NodeStatus\r\n}\r\n\r\nexport interface IMouseEventOriginData extends IEventData{\r\n  offsetX: number,\r\n  offsetY: number,\r\n  clientX: number\r\n  clientY: number\r\n  pageX: number\r\n  pageY: number\r\n  target: EventTarget | null\r\n  targetRx?: NodeRxInfo | null\r\n  view: Window | null\r\n  altKey: boolean\r\n  ctrlKey: boolean\r\n  shiftKey: boolean\r\n}\r\n\r\nexport interface IMouseEventData extends IMouseEventOriginData {\r\n  topClientX?: number\r\n  topClientY?: number\r\n  topPageX?: number\r\n  topPageY?: number\r\n}\r\n\r\nexport class AbstractMouseEvent {\r\n  data: IMouseEventData\r\n  orginalEvent: MouseEvent\r\n\r\n  constructor(data: IMouseEventOriginData, e:MouseEvent) {\r\n    this.data = data || {\r\n      clientX: 0,\r\n      clientY: 0,\r\n      pageX: 0,\r\n      pageY: 0,\r\n      target: null,\r\n      view: e.view\r\n    }\r\n    \r\n    this.orginalEvent = e\r\n    \r\n    const rxTarget = getRecentRxElement(data.target as HTMLElement)\r\n    this.data.targetRx = rxTarget && this.getRxProps(rxTarget)\r\n    this.transformCoordinates()\r\n  }\r\n\r\n  private getRxProps = (target: HTMLElement) => {\r\n    const rxId = target.getAttribute(RXID_ATTR_NAME)\r\n    const nodeType = target.getAttribute(RX_NODE_TYPE_ATTR_NAME) as (NodeType | undefined)\r\n    const nodeStatus = target.getAttribute(RX_STATUS_ATTR_NAME) as (NodeStatus | undefined)\r\n\r\n    if (rxId) {\r\n      return {\r\n        rxId,\r\n        nodeType: nodeType || NodeType.Node,\r\n        nodeStatus,\r\n      }\r\n    }\r\n  }\r\n\r\n  transformCoordinates() {\r\n    const { frameElement } = this.data?.view || {}\r\n    if (frameElement) {\r\n      const frameRect = frameElement.getBoundingClientRect()\r\n      const scale = frameRect.width / (frameElement as any)['offsetWidth']\r\n      this.data.topClientX = this.data.clientX * scale + frameRect.x\r\n      this.data.topClientY = this.data.clientY * scale + frameRect.y\r\n      this.data.topPageX =\r\n        this.data.pageX + frameRect.x - (this.data.view?.scrollX || 0)\r\n      this.data.topPageY =\r\n        this.data.pageY + frameRect.y - (this.data.view?.scrollY || 0)\r\n      const topElement = document.elementFromPoint(\r\n        this.data.topPageX,\r\n        this.data.topClientY\r\n      )\r\n      if (topElement !== frameElement) {\r\n        this.data.target = topElement as any\r\n      }\r\n    } else {\r\n      this.data.topClientX = this.data.clientX\r\n      this.data.topClientY = this.data.clientY\r\n      this.data.topPageX = this.data.pageX\r\n      this.data.topPageY = this.data.pageY\r\n    }\r\n  }\r\n}\r\n"],"names":["getRecentRxElement","NodeType","RXID_ATTR_NAME","RX_NODE_TYPE_ATTR_NAME","RX_STATUS_ATTR_NAME","AbstractMouseEvent","transformCoordinates","frameElement","data","view","frameRect","getBoundingClientRect","scale","width","topClientX","clientX","x","topClientY","clientY","y","topPageX","pageX","scrollX","topPageY","pageY","scrollY","topElement","document","elementFromPoint","target","constructor","e","getRxProps","rxId","getAttribute","nodeType","nodeStatus","Node","orginalEvent","rxTarget","targetRx"],"mappings":"AAAA,SAASA,kBAAkB,QAAQ,iCAAgC;AACnE,SAAyBC,QAAQ,EAAEC,cAAc,EAAEC,sBAAsB,EAAEC,mBAAmB,QAAQ,aAAY;AA+BlH,OAAO,MAAMC;IAmCXC,uBAAuB;YACI;QAAzB,MAAM,EAAEC,aAAY,EAAE,GAAG,CAAA,CAAA,aAAA,IAAI,CAACC,IAAI,cAAT,wBAAA,KAAA,IAAA,WAAWC,IAAI,AAAD,KAAK,CAAC;QAC7C,IAAIF,cAAc;gBAMmB,iBAEA;YAPnC,MAAMG,YAAYH,aAAaI,qBAAqB;YACpD,MAAMC,QAAQF,UAAUG,KAAK,GAAG,AAACN,YAAoB,CAAC,cAAc;YACpE,IAAI,CAACC,IAAI,CAACM,UAAU,GAAG,IAAI,CAACN,IAAI,CAACO,OAAO,GAAGH,QAAQF,UAAUM,CAAC;YAC9D,IAAI,CAACR,IAAI,CAACS,UAAU,GAAG,IAAI,CAACT,IAAI,CAACU,OAAO,GAAGN,QAAQF,UAAUS,CAAC;YAC9D,IAAI,CAACX,IAAI,CAACY,QAAQ,GAChB,IAAI,CAACZ,IAAI,CAACa,KAAK,GAAGX,UAAUM,CAAC,GAAI,CAAA,CAAA,CAAA,kBAAA,IAAI,CAACR,IAAI,CAACC,IAAI,cAAd,6BAAA,KAAA,IAAA,gBAAgBa,OAAO,AAAD,KAAK,CAAA;YAC9D,IAAI,CAACd,IAAI,CAACe,QAAQ,GAChB,IAAI,CAACf,IAAI,CAACgB,KAAK,GAAGd,UAAUS,CAAC,GAAI,CAAA,CAAA,CAAA,mBAAA,IAAI,CAACX,IAAI,CAACC,IAAI,cAAd,8BAAA,KAAA,IAAA,iBAAgBgB,OAAO,AAAD,KAAK,CAAA;YAC9D,MAAMC,aAAaC,SAASC,gBAAgB,CAC1C,IAAI,CAACpB,IAAI,CAACY,QAAQ,EAClB,IAAI,CAACZ,IAAI,CAACS,UAAU;YAEtB,IAAIS,eAAenB,cAAc;gBAC/B,IAAI,CAACC,IAAI,CAACqB,MAAM,GAAGH;YACrB,CAAC;QACH,OAAO;YACL,IAAI,CAAClB,IAAI,CAACM,UAAU,GAAG,IAAI,CAACN,IAAI,CAACO,OAAO;YACxC,IAAI,CAACP,IAAI,CAACS,UAAU,GAAG,IAAI,CAACT,IAAI,CAACU,OAAO;YACxC,IAAI,CAACV,IAAI,CAACY,QAAQ,GAAG,IAAI,CAACZ,IAAI,CAACa,KAAK;YACpC,IAAI,CAACb,IAAI,CAACe,QAAQ,GAAG,IAAI,CAACf,IAAI,CAACgB,KAAK;QACtC,CAAC;IACH;IAvDAM,YAAYtB,IAA2B,EAAEuB,CAAY,CAAE;aAiB/CC,aAAa,CAACH,SAAwB;YAC5C,MAAMI,OAAOJ,OAAOK,YAAY,CAAChC;YACjC,MAAMiC,WAAWN,OAAOK,YAAY,CAAC/B;YACrC,MAAMiC,aAAaP,OAAOK,YAAY,CAAC9B;YAEvC,IAAI6B,MAAM;gBACR,OAAO;oBACLA;oBACAE,UAAUA,YAAYlC,SAASoC,IAAI;oBACnCD;gBACF;YACF,CAAC;QACH;QA5BE,IAAI,CAAC5B,IAAI,GAAGA,QAAQ;YAClBO,SAAS;YACTG,SAAS;YACTG,OAAO;YACPG,OAAO;YACPK,QAAQ,IAAI;YACZpB,MAAMsB,EAAEtB,IAAI;QACd;QAEA,IAAI,CAAC6B,YAAY,GAAGP;QAEpB,MAAMQ,WAAWvC,mBAAmBQ,KAAKqB,MAAM;QAC/C,IAAI,CAACrB,IAAI,CAACgC,QAAQ,GAAGD,YAAY,IAAI,CAACP,UAAU,CAACO;QACjD,IAAI,CAACjC,oBAAoB;IAC3B;AAyCF,CAAC"}