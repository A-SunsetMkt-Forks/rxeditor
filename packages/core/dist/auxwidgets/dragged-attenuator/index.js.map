{"version":3,"sources":["../../../src/auxwidgets/dragged-attenuator/index.ts"],"sourcesContent":["import { IDesignerEngine, IDesignerShell, Unsubscribe } from \"../../interfaces\";\r\nimport { DragStartEvent } from \"../../shell/events/mouse\";\r\nimport { IPlugin } from \"../../interfaces/plugin\";\r\nimport { DraggingNodesState } from \"../../reducers/draggingNodes\";\r\n\r\nexport class DraggedAttenuatorImpl implements IPlugin {\r\n  name: string = \"default.dragged-attenuator\";\r\n  htmlStyle?: HTMLElement;\r\n  draggingNodesOff: Unsubscribe\r\n  weakedElements: HTMLElement[] = []\r\n  shell: IDesignerShell\r\n  startEvent: DragStartEvent | null = null\r\n  title: string = \"undefined\"\r\n  mounted: boolean = false\r\n\r\n  constructor(private engine: IDesignerEngine) {\r\n    this.shell = engine.getShell()\r\n    this.draggingNodesOff = this.engine.getMonitor().subscribeToDraggingNodes(this.handleDraggingNodes)\r\n  }\r\n\r\n  handleDraggingNodes = (dragging: DraggingNodesState | null) => {\r\n    if (dragging) {\r\n      let styleAdded = false\r\n      for (const draggingId of dragging.nodeIds) {\r\n        const element = this.shell.getElement(draggingId)\r\n        if (element) {\r\n          if (!styleAdded) {\r\n            const doc = element?.ownerDocument || document\r\n\r\n            const style = doc.createElement('style');\r\n            style.innerHTML = '.rx-dragging {  opacity: 0.4; pointer-events: none; }';\r\n            this.htmlStyle = style\r\n            const node = this.engine.getMonitor().getNode(draggingId)\r\n            if (node) {\r\n              const canvas = this.shell.getCanvas(node?.documentId)\r\n              canvas?.appendChild(this.htmlStyle)\r\n              styleAdded = true\r\n            }\r\n          }\r\n          element.classList.add(\"rx-dragging\")\r\n          this.weakedElements.push(element)\r\n        }\r\n      }\r\n    } else {\r\n      if (this.htmlStyle) {\r\n        this.htmlStyle.remove()\r\n      }\r\n      for (const element of this.weakedElements) {\r\n        element.classList.remove(\"rx-dragging\")\r\n      }\r\n      this.weakedElements = []\r\n      this.htmlStyle = undefined\r\n    }\r\n  }\r\n\r\n\r\n  destory(): void {\r\n    this.draggingNodesOff?.()\r\n  }\r\n}\r\n\r\nexport const DraggedAttenuator = (engine: IDesignerEngine) => {\r\n  return new DraggedAttenuatorImpl(engine)\r\n}"],"names":["DraggedAttenuatorImpl","destory","draggingNodesOff","constructor","engine","name","weakedElements","startEvent","title","mounted","handleDraggingNodes","dragging","styleAdded","draggingId","nodeIds","element","shell","getElement","doc","ownerDocument","document","style","createElement","innerHTML","htmlStyle","node","getMonitor","getNode","canvas","getCanvas","documentId","appendChild","classList","add","push","remove","undefined","getShell","subscribeToDraggingNodes","DraggedAttenuator"],"mappings":"AAKA,OAAO,MAAMA;IAmDXC,UAAgB;YACd,OAAA;QAAA,CAAA,yBAAA,CAAA,QAAA,IAAI,EAACC,gBAAgB,cAArB,oCAAA,KAAA,IAAA,uBAAA,KAAA;IACF;IA3CAC,YAAoBC,OAAyB;sBAAzBA;aATpBC,OAAe;aAGfC,iBAAgC,EAAE;aAElCC,aAAoC,IAAI;aACxCC,QAAgB;aAChBC,UAAmB,KAAK;aAOxBC,sBAAsB,CAACC,WAAwC;YAC7D,IAAIA,UAAU;gBACZ,IAAIC,aAAa,KAAK;gBACtB,KAAK,MAAMC,cAAcF,SAASG,OAAO,CAAE;oBACzC,MAAMC,UAAU,IAAI,CAACC,KAAK,CAACC,UAAU,CAACJ;oBACtC,IAAIE,SAAS;wBACX,IAAI,CAACH,YAAY;4BACf,MAAMM,MAAMH,CAAAA,oBAAAA,qBAAAA,KAAAA,IAAAA,QAASI,aAAa,AAAD,KAAKC;4BAEtC,MAAMC,QAAQH,IAAII,aAAa,CAAC;4BAChCD,MAAME,SAAS,GAAG;4BAClB,IAAI,CAACC,SAAS,GAAGH;4BACjB,MAAMI,OAAO,IAAI,CAACrB,MAAM,CAACsB,UAAU,GAAGC,OAAO,CAACd;4BAC9C,IAAIY,MAAM;gCACR,MAAMG,SAAS,IAAI,CAACZ,KAAK,CAACa,SAAS,CAACJ,iBAAAA,kBAAAA,KAAAA,IAAAA,KAAMK,UAAU;gCACpDF,mBAAAA,oBAAAA,KAAAA,IAAAA,OAAQG,WAAW,CAAC,IAAI,CAACP,SAAS;gCAClCZ,aAAa,IAAI;4BACnB,CAAC;wBACH,CAAC;wBACDG,QAAQiB,SAAS,CAACC,GAAG,CAAC;wBACtB,IAAI,CAAC3B,cAAc,CAAC4B,IAAI,CAACnB;oBAC3B,CAAC;gBACH;YACF,OAAO;gBACL,IAAI,IAAI,CAACS,SAAS,EAAE;oBAClB,IAAI,CAACA,SAAS,CAACW,MAAM;gBACvB,CAAC;gBACD,KAAK,MAAMpB,WAAW,IAAI,CAACT,cAAc,CAAE;oBACzCS,QAAQiB,SAAS,CAACG,MAAM,CAAC;gBAC3B;gBACA,IAAI,CAAC7B,cAAc,GAAG,EAAE;gBACxB,IAAI,CAACkB,SAAS,GAAGY;YACnB,CAAC;QACH;QArCE,IAAI,CAACpB,KAAK,GAAGZ,OAAOiC,QAAQ;QAC5B,IAAI,CAACnC,gBAAgB,GAAG,IAAI,CAACE,MAAM,CAACsB,UAAU,GAAGY,wBAAwB,CAAC,IAAI,CAAC5B,mBAAmB;IACpG;AAyCF,CAAC;AAED,OAAO,MAAM6B,oBAAoB,CAACnC,SAA4B;IAC5D,OAAO,IAAIJ,sBAAsBI;AACnC,EAAC"}