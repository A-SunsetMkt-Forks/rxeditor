{"version":3,"sources":["../../../../src/auxwidgets/toolbar/controls/MoveButton.ts"],"sourcesContent":["import { createAuxProps, IDesignerEngine, ITreeNode, NodeType, RXID_ATTR_NAME, RxProps, Unsubscribe } from \"interfaces\";\r\nimport { DragStartEvent } from \"shell/events\";\r\nimport { getOffset, getPosition } from \"shell/utils/xycoord\";\r\nimport { AbstractButton } from \"./AbstractButton\";\r\n\r\nexport class MoveButton extends AbstractButton {\r\n  private rxProps: RxProps\r\n  unsucribe?: Unsubscribe\r\n  constructor(protected engine: IDesignerEngine) {\r\n    super(\"default.move-button\", engine)\r\n    this.rxProps = createAuxProps()\r\n  }\r\n\r\n  handleDragStart = (e: DragStartEvent) => {\r\n    if (e.data.targetRx?.nodeType === NodeType.AuxWidget && e.data.targetRx?.rxId === this.rxProps[RXID_ATTR_NAME]) {\r\n      const nodeId = this.engine.getMonitor().getCurrentNode()?.id\r\n      if (nodeId) {\r\n        const beheavior = this.engine.getNodeBehavior(nodeId)\r\n        if (beheavior.isDraggable()) {\r\n          this.engine.getActions().startDragNodes({\r\n            initialMousePosition: getPosition(e.data),\r\n            offset: getOffset(e.data),\r\n            nodeIds: [nodeId],\r\n            mousePosition: getPosition(e.data)\r\n          })\r\n        }\r\n      }\r\n    }\r\n  }\r\n  \r\n  onRender(node: ITreeNode): HTMLElement | null {\r\n    const behavior = this.engine.getNodeBehavior(node.id)\r\n    if (!behavior.isDraggable() || node.isSlot) {\r\n      this.teardown()\r\n      return null\r\n    }\r\n    this.unsucribe = this.engine.getShell().subscribeTo(DragStartEvent, this.handleDragStart)\r\n    const htmlEl = this.createHtmlElement()\r\n    htmlEl.innerHTML = `\r\n    <svg style=\"width:16px;height:16px\" viewBox=\"0 0 24 24\">\r\n      <path fill=\"currentColor\" d=\"M13,11H18L16.5,9.5L17.92,8.08L21.84,12L17.92,15.92L16.5,14.5L18,13H13V18L14.5,16.5L15.92,17.92L12,21.84L8.08,17.92L9.5,16.5L11,18V13H6L7.5,14.5L6.08,15.92L2.16,12L6.08,8.08L7.5,9.5L6,11H11V6L9.5,7.5L8.08,6.08L12,2.16L15.92,6.08L14.5,7.5L13,6V11Z\" />\r\n    </svg>\r\n    `\r\n    htmlEl.style.cursor = \"move\"\r\n    for (const key of Object.keys(this.rxProps)) {\r\n      htmlEl.setAttribute(key, (this.rxProps as any)[key])\r\n    }\r\n\r\n    return htmlEl\r\n  }\r\n\r\n  teardown(): void {\r\n    this.unsucribe?.()\r\n    super.teardown()\r\n  }\r\n}"],"names":["createAuxProps","NodeType","RXID_ATTR_NAME","DragStartEvent","getOffset","getPosition","AbstractButton","MoveButton","onRender","node","behavior","engine","getNodeBehavior","id","isDraggable","isSlot","teardown","unsucribe","getShell","subscribeTo","handleDragStart","htmlEl","createHtmlElement","innerHTML","style","cursor","key","Object","keys","rxProps","setAttribute","constructor","e","data","targetRx","nodeType","AuxWidget","rxId","nodeId","getMonitor","getCurrentNode","beheavior","getActions","startDragNodes","initialMousePosition","offset","nodeIds","mousePosition"],"mappings":"AAAA,SAASA,cAAc,EAA8BC,QAAQ,EAAEC,cAAc,QAA8B,aAAa;AACxH,SAASC,cAAc,QAAQ,eAAe;AAC9C,SAASC,SAAS,EAAEC,WAAW,QAAQ,sBAAsB;AAC7D,SAASC,cAAc,QAAQ,mBAAmB;AAElD,OAAO,MAAMC,mBAAmBD;IAyB9BE,SAASC,IAAe,EAAsB;QAC5C,MAAMC,WAAW,IAAI,CAACC,MAAM,CAACC,eAAe,CAACH,KAAKI,EAAE;QACpD,IAAI,CAACH,SAASI,WAAW,MAAML,KAAKM,MAAM,EAAE;YAC1C,IAAI,CAACC,QAAQ;YACb,OAAO,IAAI;QACb,CAAC;QACD,IAAI,CAACC,SAAS,GAAG,IAAI,CAACN,MAAM,CAACO,QAAQ,GAAGC,WAAW,CAAChB,gBAAgB,IAAI,CAACiB,eAAe;QACxF,MAAMC,SAAS,IAAI,CAACC,iBAAiB;QACrCD,OAAOE,SAAS,GAAG,CAAC;;;;IAIpB,CAAC;QACDF,OAAOG,KAAK,CAACC,MAAM,GAAG;QACtB,KAAK,MAAMC,OAAOC,OAAOC,IAAI,CAAC,IAAI,CAACC,OAAO,EAAG;YAC3CR,OAAOS,YAAY,CAACJ,KAAK,AAAC,IAAI,CAACG,OAAO,AAAQ,CAACH,IAAI;QACrD;QAEA,OAAOL;IACT;IAEAL,WAAiB;YACf,OAAA;QAAA,CAAA,kBAAA,CAAA,QAAA,IAAI,EAACC,SAAS,cAAd,6BAAA,KAAA,IAAA,gBAAA,KAAA;QACA,KAAK,CAACD,QAAQ;IAChB;IA9CAe,YAAsBpB,OAAyB;QAC7C,KAAK,CAAC,uBAAuBA;sBADTA;aAKtBS,kBAAkB,CAACY,IAAsB;gBACnCA,kBAAoDA;YAAxD,IAAIA,CAAAA,CAAAA,mBAAAA,EAAEC,IAAI,CAACC,QAAQ,cAAfF,8BAAAA,KAAAA,IAAAA,iBAAiBG,QAAQ,AAAD,MAAMlC,SAASmC,SAAS,IAAIJ,CAAAA,CAAAA,oBAAAA,EAAEC,IAAI,CAACC,QAAQ,cAAfF,+BAAAA,KAAAA,IAAAA,kBAAiBK,IAAI,AAAD,MAAM,IAAI,CAACR,OAAO,CAAC3B,eAAe,EAAE;oBAC/F;gBAAf,MAAMoC,SAAS,CAAA,yCAAA,IAAI,CAAC3B,MAAM,CAAC4B,UAAU,GAAGC,cAAc,gBAAvC,oDAAA,KAAA,IAAA,uCAA2C3B,EAAE;gBAC5D,IAAIyB,QAAQ;oBACV,MAAMG,YAAY,IAAI,CAAC9B,MAAM,CAACC,eAAe,CAAC0B;oBAC9C,IAAIG,UAAU3B,WAAW,IAAI;wBAC3B,IAAI,CAACH,MAAM,CAAC+B,UAAU,GAAGC,cAAc,CAAC;4BACtCC,sBAAsBvC,YAAY2B,EAAEC,IAAI;4BACxCY,QAAQzC,UAAU4B,EAAEC,IAAI;4BACxBa,SAAS;gCAACR;6BAAO;4BACjBS,eAAe1C,YAAY2B,EAAEC,IAAI;wBACnC;oBACF,CAAC;gBACH,CAAC;YACH,CAAC;QACH;QAlBE,IAAI,CAACJ,OAAO,GAAG7B;IACjB;AA4CF,CAAC"}