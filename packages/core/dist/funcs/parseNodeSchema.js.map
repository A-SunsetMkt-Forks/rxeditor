{"version":3,"sources":["../../src/funcs/parseNodeSchema.ts"],"sourcesContent":["import { ID, IDesignerEngine, INodeSchema, ITreeNode, NodeChunk, RXID_ATTR_NAME } from \"interfaces\";\r\nimport { NodesById } from \"reducers/nodesById\";\r\nimport { makeRxId } from \"utils/make-rxId\";\r\nimport { isArr } from \"utils/types\";\r\n\r\nexport function parseNodeSchema(engine: IDesignerEngine, documentId: ID, schema: INodeSchema, nodesById: NodesById, isSlot: boolean, parentId?: string): ITreeNode {\r\n  const { children, slots = {}, ...metaData } = schema;\r\n  const rxId = makeRxId()\r\n  const locales = engine.getLoacalesManager()\r\n  const components = engine.getComponentManager()\r\n  const comDesigner = components.getComponentDesigner(metaData.componentName)\r\n  const node: ITreeNode = {\r\n    id: rxId,\r\n    isSlot,\r\n    documentId,\r\n    parentId: parentId,\r\n    title: locales.getComponentMessage(schema.componentName, \"title\") || schema.componentName,\r\n    description: locales.getComponentMessage(schema.componentName, \"description\") || undefined,\r\n    children: [],\r\n    meta: metaData,\r\n    rxProps: {\r\n      [RXID_ATTR_NAME]: rxId,\r\n    },\r\n    designerSchema: comDesigner?.designerSchema,\r\n    designerProps: comDesigner?.designerProps,\r\n    //designerParams: comDesigner?.designerParams,\r\n    slots: {},\r\n  };\r\n  for (const child of children || []) {\r\n    const childNode = parseNodeSchema(engine, documentId, child, nodesById, false, node.id);\r\n    node.children.push(childNode.id);\r\n  }\r\n  for (const key of Object.keys(slots)) {\r\n    const slot = slots[key]\r\n    if (slot && node.slots) {\r\n      const slotNode = parseNodeSchema(engine, documentId, slot, nodesById, true, node.id);\r\n      node.slots[key] = slotNode.id\r\n    }\r\n  }\r\n  nodesById[node.id] = node;\r\n  return node;\r\n}\r\n\r\nexport function paseNodes(engine: IDesignerEngine, documentId: ID, elements: INodeSchema[] | INodeSchema): NodeChunk {\r\n  const nodesById = {}\r\n  const els = isArr(elements) ? elements : [elements]\r\n  const nodes = els.map(element => parseNodeSchema(engine, documentId, element, nodesById, false))\r\n\r\n  return {\r\n    rootNodes: nodes,\r\n    nodesById\r\n  }\r\n}"],"names":["RXID_ATTR_NAME","makeRxId","isArr","parseNodeSchema","engine","documentId","schema","nodesById","isSlot","parentId","children","slots","metaData","rxId","locales","getLoacalesManager","components","getComponentManager","comDesigner","getComponentDesigner","componentName","node","id","title","getComponentMessage","description","undefined","meta","rxProps","designerSchema","designerProps","child","childNode","push","key","Object","keys","slot","slotNode","paseNodes","elements","els","nodes","map","element","rootNodes"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,SAAiEA,cAAc,QAAQ,aAAa;AAEpG,SAASC,QAAQ,QAAQ,kBAAkB;AAC3C,SAASC,KAAK,QAAQ,cAAc;AAEpC,OAAO,SAASC,gBAAgBC,MAAuB,EAAEC,UAAc,EAAEC,MAAmB,EAAEC,SAAoB,EAAEC,MAAe,EAAEC,QAAiB,EAAa;IACjK,MAAM,EAAEC,SAAQ,EAAEC,OAAQ,CAAC,EAAC,EAAe,GAAGL,QAAbM,oCAAaN;QAAtCI;QAAUC;;IAClB,MAAME,OAAOZ;IACb,MAAMa,UAAUV,OAAOW,kBAAkB;IACzC,MAAMC,aAAaZ,OAAOa,mBAAmB;IAC7C,MAAMC,cAAcF,WAAWG,oBAAoB,CAACP,SAASQ,aAAa;IAC1E,MAAMC,OAAkB;QACtBC,IAAIT;QACJL;QACAH;QACAI,UAAUA;QACVc,OAAOT,QAAQU,mBAAmB,CAAClB,OAAOc,aAAa,EAAE,YAAYd,OAAOc,aAAa;QACzFK,aAAaX,QAAQU,mBAAmB,CAAClB,OAAOc,aAAa,EAAE,kBAAkBM;QACjFhB,UAAU,EAAE;QACZiB,MAAMf;QACNgB,SAAS;YACP,CAAC5B,eAAe,EAAEa;QACpB;QACAgB,gBAAgBX,wBAAAA,yBAAAA,KAAAA,IAAAA,YAAaW,cAAc;QAC3CC,eAAeZ,wBAAAA,yBAAAA,KAAAA,IAAAA,YAAaY,aAAa;QACzC,8CAA8C;QAC9CnB,OAAO,CAAC;IACV;IACA,KAAK,MAAMoB,SAASrB,YAAY,EAAE,CAAE;QAClC,MAAMsB,YAAY7B,gBAAgBC,QAAQC,YAAY0B,OAAOxB,WAAW,KAAK,EAAEc,KAAKC,EAAE;QACtFD,KAAKX,QAAQ,CAACuB,IAAI,CAACD,UAAUV,EAAE;IACjC;IACA,KAAK,MAAMY,OAAOC,OAAOC,IAAI,CAACzB,OAAQ;QACpC,MAAM0B,OAAO1B,KAAK,CAACuB,IAAI;QACvB,IAAIG,QAAQhB,KAAKV,KAAK,EAAE;YACtB,MAAM2B,WAAWnC,gBAAgBC,QAAQC,YAAYgC,MAAM9B,WAAW,IAAI,EAAEc,KAAKC,EAAE;YACnFD,KAAKV,KAAK,CAACuB,IAAI,GAAGI,SAAShB,EAAE;QAC/B,CAAC;IACH;IACAf,SAAS,CAACc,KAAKC,EAAE,CAAC,GAAGD;IACrB,OAAOA;AACT,CAAC;AAED,OAAO,SAASkB,UAAUnC,MAAuB,EAAEC,UAAc,EAAEmC,QAAqC,EAAa;IACnH,MAAMjC,YAAY,CAAC;IACnB,MAAMkC,MAAMvC,MAAMsC,YAAYA,WAAW;QAACA;KAAS;IACnD,MAAME,QAAQD,IAAIE,GAAG,CAACC,CAAAA,UAAWzC,gBAAgBC,QAAQC,YAAYuC,SAASrC,WAAW,KAAK;IAE9F,OAAO;QACLsC,WAAWH;QACXnC;IACF;AACF,CAAC"}